# -- Editing / Nav / Fs --------------------------------------------------------
alias pbcopy='xsel -b'
alias ...='cd ../../'
alias ....='cd ../../../'
alias ag='rg'
alias k='kubectl'

fzf_cmd() {
  cat | fzf-tmux --query "$*" | tr -d "\\n" | sed -e 's/^enter//g'
}

ff() {
  INAMES=()
  for X in "$@"; do
    INAMES+=("-iname" "*${X}*")
  done
  find ./ $INAMES
}
alias s='subl3 -a'
alias svi='sudo vim'
sag() {
  s $(ag -l "$*" | fzf_cmd)
}
sff() {
  s $(ff "$*" | fzf_cmd)
}
vil() {
  vi "${1}" +$(< "${1}" | nl -ba -nln | fzf_cmd | cut -d' ' -f1)
}
alias i='idea'
own() {
  sudo chown -R $(id -un): .
}
alias sshfs="sshfs -o idmap=user,allow_other,reconnect,no_readahead,uid=$(id -u),gid=$(id -g),umask=113"

# -- Containers ----------------------------------------------------------------
alias dk='docker-compose'
dps() {
  docker ps $@ --format "table {{.ID}}\t{{.Names}}\t{{.Status}}\t{{.Image}}\t{{.Ports}}" | grep -v pause
}
kcs() {
  context=$(kubectl config get-contexts --no-headers | sort | fzf_cmd "$*" | tr -s ' ' | cut -d' ' -f2)
  [ ! -z "$context" ] && kubectl config use-context $context
  touch "${HOME}/.kube"
}

kns() {
  ns=$(kubectl get namespaces --no-headers | sort | fzf_cmd "$*" | tr -s ' ' | cut -d' ' -f1)
  [ ! -z "$ns" ] && kubectl config set-context $(kubectl config current-context) --namespace="$ns"
  touch "${HOME}/.kube"
}
alias koff='kubectl config unset current-context'

# -- Cops ----------------------------------------------------------------------
stm() {
  ec2-toys list --filters "Name=instance-state-name,Values=running Name=tag:Team,Values=$TEAM_TAG" \
  | grep linux | fzf_cmd "$*" \
  | tr -d "\\n" | sed -e 's/^enter//g' \
  | awk '{print $2}' \
  | xargs -I{} sh -c 'ssh {} < /dev/tty' ssh
}

# -- Languages -----------------------------------------------------------------
alias npm.removeglobals="npm ls -gp | awk -F/ '/node_modules/ && !/node_modules.*node_modules/ {print $NF}' | xargs npm -g rm" # node
alias cow='composer update nothing' # php

# -- Storage -------------------------------------------------------------------
alias to='tomb open $TOMB_FILE -k $TOMB_KEY -f'
alias tc='tomb close'

# -- Z / Misc ------------------------------------------------------------------
alias derp='eval $(thefuck $(fc -ln -1 | tail -n 1)); fc -R'
alias vps="mosh vps -p 1919"
TEEE="t -t ${HOME}/Dropbox/Tasks"
alias t="${TEEE}"
alias tlk="${TEEE} -l k"
alias tlro="${TEEE} -l ro"
tsh() {
  ssh -t $@ "tmux attach -t base || exec tmux new -s base"
}
alias yaourt='yaourt --noconfirm'
_pass() {
  local fzf_cmd
  fzf_cmd=$1; shift
  lpass status -q || lpass login --trust ${LPASS_USER}
  lpass ls  | $fzf_cmd --query "$*" -1 | awk '{print $(NF)}' | sed 's/\]//g'
}
pass() {
  lpass show --password $(_pass fzf "$@")
}
tn() {
  local s_name
  s_name=${@:-base}
  tmux attach -t ${=s_name} || tmux new -s ${=s_name}
}
alias ccat='pygmentize -g'

