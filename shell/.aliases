# -- Nav / Fs ------------------------------------------------------------------
alias pbcopy='xsel -b'
alias ...='cd ../../'
alias ....='cd ../../../'
RIPGREP="rg --hidden --follow --smart-case"
alias rg="$RIPGREP"
fzf_cmd() {
  # Drop empty queries
  local q
  q=$(echo "$*" | sed -e 's/\(.*\)--query \(.*\)/\2/g')

  if [[ -z $q ]]; then
    cat | fzf-tmux --multi | tail -n +2
  else
    cat | grep -i "$q" | fzf-tmux -1 $* | tail -n +2
  fi
}
own() {
  sudo chown -R $(id -un): $*
}

# -- Python --------------------------------------------------------------------
venv() {
  deactivate 2>/dev/null
  python -mvenv .venv --prompt "$*"
  source .venv/bin/activate
  pip install -U pip
  [ -f requirements.txt ] && pip install -r requirements.txt || true
  [ -f test-requirements.txt ] && pip install -r test-requirements.txt || true
}
alias pipu='pip install -U pip'

# -- Editors -------------------------------------------------------------------
alias s='subl3 -a'
alias svi='sudo vim'
sag() {
  local file_list
  file_list=$(rg $* | fzf_cmd)
  [[ ! -z $file_list ]] && s $file_list
}
vil() {
  vi "${1}" +$(< "${1}" | nl -ba -nln | fzf_cmd | cut -d' ' -f1)
}
i() {
  /opt/intellij-idea-ultimate-edition/bin/idea.sh $* 2>/dev/null 1>&2 &
}

# -- Turtles -------------------------------------------------------------------
alias k='kubectl'
alias dk='docker-compose'
alias koff='kubectl config unset current-context'
dps() {
  docker ps $@ \
    --format "table {{.ID}}\t{{.Names}}\t{{.Status}}\t{{.Image}}\t{{.Ports}}" \
    | grep -v pause
}
ec2-list() {
  local team="$1"; shift
  ec2-toys list --filters "Name=instance-state-name,Values=running Name=tag:Team,Values=$team" | grep linux
}
ec2-ip() {
  memoize ec2-list $* | fzf_cmd | awk '{print $2}'
}

# -- Storage -------------------------------------------------------------------
alias to='tomb open $TOMB_FILE -k $TOMB_KEY -f'
alias tc='tomb close'
alias sshfs="sshfs -o idmap=user,allow_other,reconnect,no_readahead,uid=$(id -u),gid=$(id -g),umask=113"

# -- Z / Misc ------------------------------------------------------------------
alias derp='eval $(thefuck $(fc -ln -1 | tail -n 1)); fc -R'
alias vps="mosh vps -p 1919"
TEEE="t -t ${HOME}/Dropbox/_Tasks"
alias t="${TEEE}"
alias tlk="${TEEE} -l k"
alias tlro="${TEEE} -l ro"
alias yaourt='yaourt --noconfirm'
alias ccat='pygmentize -g'
alias x509='openssl x509 -noout -text -in '
tsh() {
  ssh -t $@ "tmux attach -t base || exec tmux new -s base"
}
_fzf_pass() {
  local pwdir="${HOME}/.password-store/"
  local stringsize="${#pwdir}"
  ((stringsize+=1))
  find "$pwdir" -name "*.gpg" -print | cut -c "$stringsize"- \
    | sed -e 's/\(.*\)\.gpg/\1/' | fzf_cmd --query "$*"
}
passs() {
  pass show $(_fzf_pass "$@") | head -1
}
tn() {
  local s_name
  s_name=${@:-base}
  tmux attach -t ${=s_name} || tmux new -s ${=s_name}
}
ssh-add() {
  chmod 400 "$@"
  command ssh-add "$@"
}
mp3() {
  youtube-dl --ignore-errors -f bestaudio --extract-audio --audio-format mp3 \
    --audio-quality 0 -o '~/Desktop/youtube/%(title)s.%(ext)s' "$1"
}
mp3p () {
  youtube-dl --ignore-errors -f bestaudio --extract-audio --audio-format mp3 \
    --audio-quality 0 \
    -o '~/Dekstop/youtube/%(playlist)s/%(playlist_index)s - %(title)s.%(ext)s' \
    "$1"
}
