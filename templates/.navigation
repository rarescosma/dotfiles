# Expand the full path when changing to a symlinked directory
cdp() { cd $1; cd `pwd -P`; }

# Aliases pushd
# A numeric argument pops the directory at that index in the stack
# A path argument is just relayed to pushd
p() {
	if [[ "$1" == [0-9] ]]; then
		pushd -$1
	else
		pushd $1
	fi
}

# Looks for ".krc" files when changing directories and executes them
function chpwd() {
	if [[ -a .krc ]]; then
		p=$(readlink -e .krc)
		sum=$(echo -n $p | md5sum | awk '{ print $1 }')

		if [[ ! -a /tmp/krc/$session/$sum ]]; then
			if (( $? == 0 )); then
				mkdir -p /tmp/krc/$session
				touch /tmp/krc/$session/$sum
			fi
			source $p
		fi
	fi
}

session=$(cat /dev/urandom | tr -cd 'a-f0-9' | head -c 16)
rm -rf /tmp/krc/$session